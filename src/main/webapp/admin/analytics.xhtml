
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:f="jakarta.faces.core"
                xmlns:p="http://primefaces.org/ui"
                template="/partial/template.xhtml">

    <ui:define name="content">
        <div class="analytics-container">
            <div class="page-head-line">Analytics Dashboard</div>

            <!-- KPI Summary Cards -->
            <div class="grid">
                <div class="col-12 md:col-6 lg:col-3">
                    <div class="surface-card shadow-2 p-4 border-round">
                        <div class="flex justify-content-between mb-3">
                            <div>
                                <span class="block text-500 font-medium mb-3">Total Revenue</span>
                                <div class="text-0 font-medium text-xl">KES #{analyticsController.summary.totalRevenue}</div>
                            </div>
                            <div class="flex align-items-center justify-content-center bg-blue-100 border-round" style="width:2.5rem;height:2.5rem">
                                <i class="pi pi-dollar text-blue-500 text-xl"></i>
                            </div>
                        </div>
                        <span class="text-green-500 font-medium">#{analyticsController.revenueGrowth}% </span>
                        <span class="text-500">growth from last month</span>
                    </div>
                </div>

                <div class="col-12 md:col-6 lg:col-3">
                    <div class="surface-card shadow-2 p-4 border-round">
                        <div class="flex justify-content-between mb-3">
                            <div>
                                <span class="block text-500 font-medium mb-3">Total Trips</span>
                                <div class="text-0 font-medium text-xl">#{analyticsController.summary.totalTrips}</div>
                            </div>
                            <div class="flex align-items-center justify-content-center bg-orange-100 border-round" style="width:2.5rem;height:2.5rem">
                                <i class="pi pi-map-marker text-orange-500 text-xl"></i>
                            </div>
                        </div>
                        <span class="text-green-500 font-medium">#{analyticsController.tripGrowth}% </span>
                        <span class="text-500">increase from last month</span>
                    </div>
                </div>

                <div class="col-12 md:col-6 lg:col-3">
                    <div class="surface-card shadow-2 p-4 border-round">
                        <div class="flex justify-content-between mb-3">
                            <div>
                                <span class="block text-500 font-medium mb-3">Average Revenue/Trip</span>
                                <div class="text-0 font-medium text-xl">KES <h:outputText value="#{analyticsController.summary.avgRevenuePerTrip}">
                                        <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                                    </h:outputText></div>
                            </div>
                            <div class="flex align-items-center justify-content-center bg-cyan-100 border-round" style="width:2.5rem;height:2.5rem">
                                <i class="pi pi-chart-line text-cyan-500 text-xl"></i>
                            </div>
                        </div>
                        <span class="text-#{analyticsController.avgRevenueGrowth >= 0 ? 'green' : 'red'}-500 font-medium"><h:outputText value="#{analyticsController.avgRevenueGrowth}">
                                <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                            </h:outputText>% </span>
                        <span class="text-500">from last month</span>
                    </div>
                </div>

                <div class="col-12 md:col-6 lg:col-3">
                    <div class="surface-card shadow-2 p-4 border-round">
                        <div class="flex justify-content-between mb-3">
                            <div>
                                <span class="block text-500 font-medium mb-3">Total Profit</span>
                                <div class="text-0 font-medium text-xl">KES #{analyticsController.summary.totalProfit}</div>
                            </div>
                            <div class="flex align-items-center justify-content-center bg-purple-100 border-round" style="width:2.5rem;height:2.5rem">
                                <i class="pi pi-wallet text-purple-500 text-xl"></i>
                            </div>
                        </div>
                        <span class="text-#{analyticsController.profitGrowth >= 0 ? 'green' : 'red'}-500 font-medium">#{analyticsController.profitGrowth}% </span>
                        <span class="text-500">from last month</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid mt-3">
                <div class="col-12 lg:col-6">
                    <div class="surface-card shadow-2 border-round p-4">
                        <h5>Revenue Trends</h5>
                        <p:chart value="#{analyticsController.revenueChartJson}" 
                                 widgetVar="revenueChart" style="height:570px" />
                    </div>
                </div>

                <div class="col-12 lg:col-6">
                    <div class="surface-card shadow-2 border-round p-4">
                        <h5>Trip Distribution</h5>
                        <p:chart value="#{analyticsController.tripDistributionChartJson}" 
                                 widgetVar="tripDistributionChart" style="height:500px" />
                    </div>
                </div>

                <div class="col-12">
                    <div class="surface-card shadow-2 border-round p-4">
                        <h5>Route Performance</h5>
                        <p:chart value="#{analyticsController.routePerformanceChartJson}" 
                                 widgetVar="routePerformanceChart" style="height:300px" />
                    </div>
                </div>
            </div>

            <!-- Detailed Analytics Table -->
            <div class="surface-card shadow-2 border-round p-4 mt-3">
                <div class="flex justify-content-between p-ai-center mb-3">
                            <h3 class="m-0">Trip Insights</h3>
                            <p:commandButton icon="pi pi-file-pdf"
                                             title="Export analytics to PDF"
                                             styleClass="p-button-sm p-button-text">
                                <p:dataExporter type="pdf"
                                                target="analyticsTable"
                                                fileName="Analytics"
                                                pageOnly="false"/>
                            </p:commandButton>
                        </div>
                <p:dataTable id="analyticsTable" value="#{analyticsController.detailedAnalytics}" var="analytic"
                             paginator="true" rows="10" paginatorPosition="bottom">
                    <p:column headerText="Date" sortBy="#{analytic.date}">
                        <h:outputText value="#{analytic.date}">
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Route" sortBy="#{analytic.route}">
                        #{analytic.route}
                    </p:column>
                    <p:column headerText="Trips" sortBy="#{analytic.trips}">
                        #{analytic.trips}
                    </p:column>
                    <p:column headerText="Revenue" sortBy="#{analytic.revenue}">
                        KES #{analytic.revenue}
                    </p:column>
                    <p:column headerText="Profit" sortBy="#{analytic.profit}">
                        KES #{analytic.profit}
                    </p:column>
                </p:dataTable>
            </div>
        </div>
    </ui:define>
</ui:composition>
